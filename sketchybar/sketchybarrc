#!/usr/bin/env bash

# ╔════════════════════════════════════════════════════════════════════════════╗
# ║  SKETCHYBAR CONFIG - Edit freely!                                          ║
# ║                                                                            ║
# ║  Reload after changes: sketchybar --reload                                 ║
# ║  Auto-refresh: Yes, items refresh based on update_freq (in seconds)        ║
# ║                                                                            ║
# ║  Positions: left | center | right                                          ║
# ║  Colors: 0xAARRGGBB (AA=alpha, 00=transparent, ff=opaque)                  ║
# ╚════════════════════════════════════════════════════════════════════════════╝

PLUGIN_DIR="$CONFIG_DIR/plugins"

# === COLORS (Catppuccin Pastel - matching ghostty) ===
BAR_COLOR=0xee1a1d23   # Bar background (mantle)
SURFACE=0xff2a2e3a     # Item backgrounds (surface_0)
TEXT=0xffb0b8c8        # Normal text (foreground)
TEXT_BRIGHT=0xffcdd6f4 # Bright text (subtext)
DIM=0xff4a5060         # Dimmed text (overlay)
ACCENT=0xff7dd3c0      # Mint accent (green)
RED=0xfff38ba8         # Red/Pink
GREEN=0xff7dd3c0       # Mint green
YELLOW=0xfff9e2af      # Yellow
BLUE=0xff89b4fa        # Blue
MAGENTA=0xffcba6f7     # Lavender
TEAL=0xff94e2d5        # Teal
TRANSPARENT=0x00000000

# === BAR ===
sketchybar --bar \
  height=38 \
  position=top \
  color=$BAR_COLOR \
  blur_radius=30 \
  sticky=on \
  padding_left=12 \
  padding_right=12 \
  notch_width=200

# === DEFAULTS ===
sketchybar --default \
  icon.font="Maple Mono NF:Bold:16.0" \
  icon.color=$TEXT_BRIGHT \
  icon.padding_left=8 \
  icon.padding_right=6 \
  label.font="Maple Mono NF:Bold:15.0" \
  label.color=$TEXT_BRIGHT \
  label.padding_left=6 \
  label.padding_right=10 \
  background.color=$SURFACE \
  background.corner_radius=8 \
  background.height=28 \
  background.padding_left=4 \
  background.padding_right=4

# ══════════════════════════════════════════════════════════════════════════════
# LEFT SIDE: Workspaces
# ══════════════════════════════════════════════════════════════════════════════

sketchybar --add event aerospace_workspace_change

for i in 1 2 3 4 5; do
  sketchybar --add item space.$i left \
    --set space.$i \
    icon="$i" \
    icon.color=$DIM \
    icon.highlight_color=$ACCENT \
    icon.padding_left=12 \
    icon.padding_right=12 \
    label.drawing=off \
    background.color=$TRANSPARENT \
    background.corner_radius=6 \
    script="$PLUGIN_DIR/aerospace.sh" \
    click_script="aerospace workspace $i" \
    --subscribe space.$i aerospace_workspace_change
done

# ══════════════════════════════════════════════════════════════════════════════
# CENTER: Now Playing
# ══════════════════════════════════════════════════════════════════════════════

sketchybar --add item media left \
  --set media \
  icon="" \
  icon.font="Maple Mono NF:Bold:18.0" \
  icon.padding_left=14 \
  label.font="Maple Mono NF:Bold:14.0" \
  label.max_chars=30 \
  label.scroll_duration=150 \
  label.padding_right=14 \
  scroll_texts=on \
  background.color=$SURFACE \
  script="$PLUGIN_DIR/media.sh" \
  click_script="$PLUGIN_DIR/media.sh click" \
  update_freq=5

# ══════════════════════════════════════════════════════════════════════════════
# RIGHT SIDE: Status Items
# ══════════════════════════════════════════════════════════════════════════════

sketchybar --add item clock right \
  --set clock \
  icon="󰥔" \
  icon.color=$ACCENT \
  background.color=$SURFACE \
  script="$PLUGIN_DIR/clock.sh" \
  click_script="open -a Calendar" \
  update_freq=30

sketchybar --add item date right \
  --set date \
  icon="󰃭" \
  icon.color=$BLUE \
  background.color=$SURFACE \
  script="$PLUGIN_DIR/calendar.sh" \
  click_script="open -a Calendar" \
  update_freq=3600

sketchybar --add item battery right \
  --set battery \
  icon.font="Maple Mono NF:Bold:17.0" \
  background.color=$SURFACE \
  script="$PLUGIN_DIR/battery.sh" \
  click_script="open x-apple.systempreferences:com.apple.Battery-Settings.extension" \
  update_freq=30

sketchybar --add item volume right \
  --set volume \
  icon="󰕾" \
  icon.color=$ACCENT \
  background.color=$SURFACE \
  script="$PLUGIN_DIR/volume.sh" \
  click_script="osascript -e 'set volume output muted not (output muted of (get volume settings))' && $PLUGIN_DIR/volume.sh" \
  update_freq=5

sketchybar --add item wifi right \
  --set wifi \
  icon="󰤨" \
  icon.color=$TEAL \
  background.color=$SURFACE \
  script="$PLUGIN_DIR/wifi.sh" \
  click_script="open x-apple.systempreferences:com.apple.Network-Settings.extension" \
  update_freq=10

sketchybar --add item cpu right \
  --set cpu \
  icon="󰻠" \
  icon.color=$YELLOW \
  background.color=$SURFACE \
  script="$PLUGIN_DIR/cpu.sh" \
  click_script="open -a 'Activity Monitor'" \
  update_freq=5

# ══════════════════════════════════════════════════════════════════════════════
sketchybar --update
